{% extends 'base.html' %}

{% block title %}SWA V2 - Your Profile{% endblock %}

{% block content %}
<!-- Flash message container -->
{% if message %}
<div style="display: none;" data-flash-message="{{ message|escapejs }}" data-flash-type="{{ message_type|default('info')|escapejs }}"></div>
{% endif %}

<div class="profile-section">
    <div class="profile-header-container">
        <div class="profile-header-overlay"></div>
        <div class="profile-header-content">
            <div class="profile-avatar-wrapper">
        <div class="profile-avatar">
            <i class="fas fa-user"></i>
                </div>
                <div class="avatar-status {% if user.launcher_connected %}connected{% endif %}">
                    <i class="fas {% if user.launcher_connected %}fa-link{% else %}fa-unlink{% endif %}"></i>
                </div>
        </div>
        <div class="profile-info">
                <h1>{{ user.username }}</h1>
            <p class="profile-email">{{ user.email }}</p>
                <div class="profile-badges">
                    <span class="profile-badge {% if user.status == 'Admin' %}admin{% elif user.status == 'Premium' %}premium{% else %}standard{% endif %}">
                        {{ user.status }}
                    </span>
                    <!-- <span class="profile-badge unique-id">ID: {{ user.unique_id }}</span> -->
                    {% if premium_expires %}
                    <span class="profile-badge premium-expiry">
                        <i class="far fa-clock"></i> Premium expires in {{ premium_expires.days_remaining }} days
                    </span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- <div class="profile-stats-wrapper">
        <div class="row g-4">
            <div class="col-md-3">
            <div class="stat-item">
                <div class="stat-icon-wrapper">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <div class="stat-info">
                    <span class="stat-label">Joined</span>
                    <span class="stat-value">{{ user.join_date }}</span>
                </div>
            </div>
        </div>
            <div class="col-md-3">
            <div class="stat-item">
                <div class="stat-icon-wrapper">
                    <i class="fas fa-gamepad"></i>
                </div>
                <div class="stat-info">
                        <span class="stat-label">Games Played</span>
                        <span class="stat-value">{{ user.games_played|default(0) }}</span>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
            <div class="stat-item">
                <div class="stat-icon-wrapper">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-info">
                        <span class="stat-label">Total Play Time</span>
                        <span class="stat-value">{{ user.total_play_time|default("0h 0m") }}</span>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-item">
                    <div class="stat-icon-wrapper">
                        <i class="fas fa-trophy"></i>
                </div>
                <div class="stat-info">
                        <span class="stat-label">Achievements</span>
                        <span class="stat-value">{{ user.achievements|default(0) }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div> -->
    
    <!-- New Launcher Connection Section -->
    <div class="profile-tabs">
        <div class="tab-navigation">
            <button class="tab-btn active" data-tab="launcher">
                <i class="fas fa-rocket"></i>
                <span>Launcher</span>
            </button>
            <button class="tab-btn" data-tab="subscription">
                <i class="fas fa-crown"></i>
                <span>Subscription</span>
            </button>
            {% if user.status != 'Premium (Aligned)' and user.status != 'Standard' %}
            <button class="tab-btn" data-tab="slots">
                <i class="fas fa-users"></i>
                <span>Slots</span>
            </button>
            {% endif %}
            <button class="tab-btn" data-tab="settings">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </button>
        </div>

        <!-- Launcher Tab -->
        <div class="tab-content active" id="launcher-tab">
            {% if user.status != 'Standard' %}
            <div class="glass-card connection-card">
                <div class="connection-header">
                    <h2 class="section-title"><i class="fas fa-link"></i> Launcher Connection</h2>
                    <div class="connection-status-badge {% if user.launcher_connected %}connected{% else %}disconnected{% endif %}">
                        <i class="fas {% if user.launcher_connected %}fa-link{% else %}fa-unlink{% endif %}"></i>
                        <span>{% if user.launcher_connected %}Connected{% else %}Not Connected{% endif %}</span>
                    </div>
                </div>
                
                <div class="connection-body">
                    <div class="download-box">
                        <div class="download-header">
                            <h3>Download Launcher</h3>
                        </div>
                        <div class="download-content">
                            <div class="download-icon">
                                <i class="fas fa-download"></i>
                            </div>
                            <p class="download-text">Download our premium launcher app to track your gaming sessions</p>
                            <div class="download-actions">
                                <a href="http://api.swa-recloud.fun//api/v3/get/SWAInstaller.exe" class="action-btn" style="text-decoration: none;">
                                    <i class="fas fa-download"></i>
                                    <span>Download</span>
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="divider"><span>AND</span></div>
                    
                    <div class="connection-code-box">
                        <div class="code-header">
                            <h3>Your Connection Code</h3>
                            <div class="code-actions">
                                <button id="regenerateCodeBtn" class="action-btn">
                                    <i class="fas fa-sync-alt"></i>
                                    <span>Regenerate</span>
                                </button>
                                <button class="copy-btn" data-clipboard-text="{{ user.launcher_code|default('') }}">
                                    <i class="fas fa-copy"></i>
                                    <span>Copy</span>
                                </button>
                            </div>
                        </div>
                        <div class="connection-code-display">
                            <span class="connection-code">{{ user.launcher_code|default('') }}</span>
                        </div>
                        <div class="connection-instructions">
                            <ol>
                                <li>Copy your unique connection code</li>
                                <li>Open the SWA Launcher on your computer</li>
                                <li>Enter the code when prompted</li>
                                <li>Enjoy seamless gaming with automatic stat tracking!</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            {% if user.status != 'Standard' %}
            <!-- New Connected Devices Section -->
            <div class="glass-card devices-card">
                <div class="devices-header">
                    <h2 class="section-title"><i class="fas fa-laptop"></i> Connected Devices</h2>
                    <button id="refreshDevicesBtn" class="action-btn">
                        <i class="fas fa-sync-alt"></i>
                        <span>Refresh</span>
                    </button>
                </div>
                
                <div id="deviceList" class="devices-container">
                    <!-- Devices will be loaded through JavaScript -->
                    <div class="text-center py-3">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-2">Loading devices...</p>
                    </div>
                </div>
                
                <!-- Template for displaying devices -->
                <template id="deviceTemplate">
                    <div class="device-item">
                        <div class="device-icon">
                            <i class="fas fa-desktop"></i>
                        </div>
                        <div class="device-info">
                            <div class="device-header">
                                <div class="device-title-line">
                                    <i class="device-name"></i>
                                    <div class="device-primary-badge d-none">
                                        <span class="badge bg-primary">
                                            <i class="fas fa-shield-alt"></i> Primary Device
                                        </span>
                                    </div>
                                    <div class="device-status"></div>
                                </div>
                            </div>
                            <div class="device-meta">
                                <span class="device-id"></span>
                                <span class="device-os"></span>
                            </div>
                            <div class="device-connection-time">
                                <span class="connection-label">Last connection:</span>
                                <span class="device-connection"></span>
                            </div>
                        </div>
                        <div class="device-actions">
                            <button class="disconnect-device" data-device-id="" title="Disconnect device">
                                <i class="fas fa-unlink"></i>
                                <span>Disconnect</span>
                            </button>
                            <button class="reset-hwid-device" data-device-id="" title="Reset HWID">
                                <i class="fas fa-sync"></i>
                            </button>
                        </div>
                    </div>
                </template>
                
                <div id="noDevices" class="no-data-container d-none">
                    <div class="no-data-icon">
                        <i class="fas fa-laptop"></i>
                    </div>
                    <h3>No Devices Connected</h3>
                    <p>Use your connection code to link devices with your account.</p>
                </div>
            </div>
            {% endif %}

            <!-- Promo Code Redemption Section -->
            {% if user.status != 'Premium (Aligned)' %}
            <div class="glass-card promo-card {% if user.status == 'Standard' %}mt-0{% else %}mt-4{% endif %}">
                <div class="promo-content">
                    <div class="promo-left">
                        <h2 class="promo-title"><i class="fas fa-gift"></i> Redeem Promo Code</h2>
                        <p class="promo-subtitle">Enter your code to activate premium features</p>
                        <form action="{{ url_for('redeem_promo_code') }}" method="post" class="promo-form">
                            <div class="promo-input-container">
                                <input type="text" name="promo_code" id="promo_code" class="promo-input" placeholder="e.g. PREMIUM2023" required>
                                <button type="submit" class="promo-btn">
                                    <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                    <div class="promo-right">
                        <div class="promo-info-section">
                            <h3 class="promo-info-title">How to get a promo code?</h3>
                            <p class="promo-info-text">
                                Visit our <a href="{{ url_for('premium') }}" class="promo-link">Premium page</a> to purchase a subscription or participate in our promotions to get a code.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Subscription Info Tab -->
        <div class="tab-content" id="subscription-tab">
            <div class="glass-card">
                <div class="subscription-header">
                    <h2 class="section-title"><i class="fas fa-crown"></i> Subscription Details</h2>
                    <div class="subscription-status-badge {% if user.status == 'Premium' %}premium{% elif user.status == 'Admin' %}admin{% elif user.status == 'Premium (Aligned)' %}premium{% else %}standard{% endif %}">
                        <i class="fas {% if user.status == 'Premium' or user.status == 'Admin' or user.status == 'Premium (Aligned)' %}fa-crown{% else %}fa-user{% endif %}"></i>
                        <span>{{ user.status }}</span>
                    </div>
                </div>
                
                <div class="subscription-info">
                    {% if user.status == 'Premium' or user.status == 'Admin' or user.status == 'Premium (Aligned)' %}
                        <div class="subscription-details">
                            <div class="detail-item">
                                <div class="detail-icon">
                                    <i class="fas fa-calendar-check"></i>
                                </div>
                                <div class="detail-content">
                                    <h3>Status</h3>
                                    <p class="premium-text">Premium Membership</p>
                                    {% if user.status == 'Premium (Aligned)' and user.aligned_by %}
                                    <div class="aligned-by-info mt-2">
                                        <i class="fas fa-link"></i> Aligned by: <strong>{{ user.aligned_by }}</strong>
                                        <button class="disalign-self-btn" data-username="{{ user.username }}">
                                            <i class="fas fa-unlink"></i> Disalign
                                        </button>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="detail-item">
                                <div class="detail-icon">
                                    <i class="fas fa-hourglass-half"></i>
                                </div>
                                <div class="detail-content">
                                    <h3>Expiration</h3>
                                    {% if premium_expires %}
                                        <p class="expiry-date">Expires on {{ premium_expires.date }} ({{ premium_expires.days_remaining }} days remaining)</p>
                                    {% elif user.status == 'Premium (Aligned)' %}
                                        <p class="aligned-badge"><i class="fas fa-link"></i> Active while aligned</p>
                                    {% else %}
                                        <p class="permanent-badge"><i class="fas fa-infinity"></i> Permanent</p>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <!-- {% if slots_info and slots_info|length > 0 %}
                            <div class="detail-item">
                                <div class="detail-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="detail-content">
                                    <h3>Friend Slots</h3>
                                    <p class="slot-count">{{ user.slots|default(0) }} Available Slots</p>
                                    <div class="slots-grid">
                                        {% for slot in slots_info %}
                                        <div class="slot-card">
                                            <div class="slot-header">
                                                <span class="slot-number">{{ loop.index }}</span>
                                                <span class="slot-label">Slot</span>
                                            </div>
                                            <div class="slot-body">
                                                {% if slot.expires %}
                                                <div class="slot-expires">
                                                    <i class="far fa-clock"></i> Expires on {{ slot.expires.date }} ({{ slot.expires.days_remaining }} days)
                                                </div>
                                                {% else %}
                                                <div class="slot-expires permanent">
                                                    <i class="fas fa-infinity"></i> Never expires
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                            {% endif %} -->
                        </div>
                    {% else %}
                        <div class="upgrade-container">
                            <div class="upgrade-icon">
                                <i class="fas fa-crown"></i>
                            </div>
                            <h3>Standard Account</h3>
                            <p>You currently have a standard account with limited access. Upgrade to Premium to unlock all features!</p>
                            <a href="{{ url_for('premium') }}" class="btn-premium">
                                <i class="fas fa-crown"></i> Upgrade to Premium
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <div class="glass-card">
                <h2 class="section-title"><i class="fas fa-history"></i> Subscription History</h2>
                
                {% if premium_history %}
                    <!-- Summary section for subscription events -->
                    <div class="history-summary">
                        {% set assigned_count = premium_history|selectattr('action', 'equalto', 'Slot Assigned')|list|length %}
                        {% set freed_count = premium_history|selectattr('action', 'equalto', 'Slot Freed')|list|length %}
                        {% set expired_count = premium_history|selectattr('action', 'equalto', 'Premium Expired')|list|length %}
                        {% set granted_count = premium_history|selectattr('action', 'equalto', 'Premium Status Granted')|list|length %}
                        {% set revoked_count = premium_history|selectattr('action', 'equalto', 'Premium Status Revoked')|list|length %}
                    </div>
                
                    <div class="history-list">
                        {% for entry in premium_history %}
                            <div class="history-item">
                                <div class="history-icon">
                                    <i class="fas fa-receipt"></i>
                                </div>
                                <div class="history-content">
                                    <div class="history-date">{{ entry.date }}</div>
                                    <div class="history-title">{{ entry.action }}</div>
                                    <div class="history-details">{{ entry.details }}</div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-history">
                        <p>No subscription history available.</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Slots Tab -->
        <div class="tab-content" id="slots-tab">
            <div class="glass-card">
                <div class="slots-header">
                    <h2 class="section-title"><i class="fas fa-users"></i> Friend Slots</h2>
                    <div class="slots-counter">
                        <span class="slots-label">Available Slots:</span>
                        <span class="slots-value">{{ user.slots|default(0) }}</span>
                    </div>
                </div>

                <div class="slots-container">
                    {% if user.slots|default(0) > 0 or (user.friends and user.friends|length > 0) %}
                        <div class="slots-list">
                            {% if slots_info %}
                                {% for slot in slots_info %}
                                <div class="slot-item">
                                    <div class="slot-icon">
                                        <i class="fas fa-user-plus"></i>
                                    </div>
                                    <div class="slot-info">
                                        <div class="slot-name">Slot {{ loop.index }}</div>
                                        {% if slot.expires %}
                                        <div class="slot-expires">
                                            <i class="far fa-clock"></i> Expires on {{ slot.expires.date }} ({{ slot.expires.days_remaining }} days)
                                        </div>
                                        {% else %}
                                        <div class="slot-expires permanent">
                                            <i class="fas fa-infinity"></i> Never expires
                                        </div>
                                        {% endif %}
                                    </div>
                                    <div class="slot-actions">
                                        <div class="slot-status">
                                            {% if slot.assigned_to %}
                                            <div class="assigned-user">
                                                <span class="user-badge">
                                                    <i class="fas fa-user"></i> {{ slot.assigned_to }}
                                                    {% if slot.assigned_user_status %}
                                                    <span class="user-status {{ slot.assigned_user_status|lower|replace(' (aligned)', '') }}">
                                                        {% if 'aligned' in slot.assigned_user_status|lower %}
                                                        Premium
                                                        {% else %}
                                                        {{ slot.assigned_user_status }}
                                                        {% endif %}
                                                    </span>
                                                    {% endif %}
                                                </span>
                                                <button class="remove-user-btn" data-username="{{ slot.assigned_to }}" title="Remove user">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                            
                                            {% else %}
                                            <div class="slot-assign-form">
                                                <input type="text" class="slot-input" placeholder="Enter username">
                                                <button class="slot-assign-btn">
                                                    <i class="fas fa-arrow-right"></i>
                                                </button>
                                            </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            {% elif user.friends %}
                                {% for friend in user.friends %}
                                <div class="slot-item">
                                    <div class="slot-icon">
                                        <i class="fas fa-user-plus"></i>
                                    </div>
                                    <div class="slot-info">
                                        <div class="slot-name">Slot {{ loop.index }}</div>
                                    </div>
                                    <div class="slot-actions">
                                        <div class="slot-status">
                                            <div class="assigned-user">
                                                <span class="user-badge">
                                                    <i class="fas fa-user"></i> {{ friend }}
                                                </span>
                                                <button class="remove-user-btn" data-username="{{ friend }}" title="Remove user">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                                
                                {% if user.slots|default(0) > 0 %}
                                <div class="slot-item">
                                    <div class="slot-icon">
                                        <i class="fas fa-user-plus"></i>
                                    </div>
                                    <div class="slot-info">
                                        <div class="slot-name">New Slot</div>
                                    </div>
                                    <div class="slot-actions">
                                        <div class="slot-status">
                                            <div class="slot-assign-form">
                                                <input type="text" class="slot-input" placeholder="Enter username">
                                                <button class="slot-assign-btn">
                                                    <i class="fas fa-arrow-right"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                            {% else %}
                                <div class="no-slots-message">
                                    <p>You have slots available! Enter a username to assign a slot.</p>
                                    <div class="slot-assign-form mt-3">
                                        <input type="text" class="slot-input" placeholder="Enter username">
                                        <button class="slot-assign-btn">
                                            <i class="fas fa-arrow-right"></i>
                                        </button>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    {% else %}
                        <div class="no-slots-container">
                            <div class="no-slots-icon">
                                <i class="fas fa-user-plus"></i>
                            </div>
                            <h3>No Friend Slots Available</h3>
                            <p>Upgrade your account to get friend slots and start tracking your friends' gaming sessions!</p>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- <div class="glass-card">
                <h2 class="section-title"><i class="fas fa-gamepad"></i> Active Friend Sessions</h2>
                <div class="active-sessions-container">
                    <div class="no-sessions-container">
                        <div class="no-sessions-icon">
                            <i class="fas fa-gamepad"></i>
                        </div>
                        <h3>No Active Friend Sessions</h3>
                        <p>When your friends are playing, their sessions will appear here.</p>
                    </div>
                </div>
            </div> -->
            
            {% if expired_slots_info and expired_slots_info|length > 0 %}
            <div class="glass-card">
                <h2 class="section-title"><i class="fas fa-history"></i> Expired Slots History</h2>
                <div class="expired-slots-container">
                    <div class="history-list">
                        {% for slot in expired_slots_info %}
                        <div class="history-item">
                            <div class="history-icon">
                                <i class="fas fa-ticket-alt"></i>
                            </div>
                            <div class="history-content">
                                <div class="history-date">{{ slot.expired_at }}</div>
                                <div class="history-title">Slot Expired</div>
                                <div class="history-details">
                                    Source: {{ slot.source }}
                                    {% if slot.assigned_to %}
                                    <br>Assigned to: <strong>{{ slot.assigned_to }}</strong>
                                    {% if slot.assigned_user_status %}
                                    <span class="ex-user-status {{ slot.assigned_user_status|lower|replace(' (aligned)', '') }}">
                                        {{ slot.assigned_user_status }}
                                    </span>
                                    {% endif %}
                                    {% endif %}
                                    
                                    {% if slot.created_at %}
                                    <br>Slot created: {{ slot.created_at }}
                                    <br>Active duration: 
                                    {% if slot.expired_at and slot.created_at %}
                                    {% set created = slot.created_at|string %}
                                    {% set expired = slot.expired_at|string %}
                                    {% if created and expired %}
                                    {{ ((expired|to_datetime) - (created|to_datetime)).days }} days
                                    {% else %}
                                    Unknown
                                    {% endif %}
                                    {% else %}
                                    Unknown
                                    {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Settings Tab -->
        <div class="tab-content" id="settings-tab">
            <div class="glass-card">
                <div class="password-management-header">
                    <i class="fas fa-key password-icon"></i>
                    <div>
                        <h3>Password Management</h3>
                        <p class="password-subtitle">Update your password to keep your account secure</p>
                    </div>
                </div>
                
                <form method="post" action="/profile/password" class="settings-form">
                    <div class="form-group">
                        <label for="current_password">Current Password</label>
                        <div class="input-wrapper">
                            <i class="fas fa-lock input-icon"></i>
                            <input type="password" id="current_password" name="current_password" class="form-control" required>
                            <button type="button" class="password-toggle" data-target="current_password">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="new_password">New Password</label>
                        <div class="input-wrapper">
                            <i class="fas fa-key input-icon"></i>
                            <input type="password" id="new_password" name="new_password" class="form-control" required>
                            <button type="button" class="password-toggle" data-target="new_password">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="password-strength">
                            <div class="strength-meter">
                                <div class="strength-indicator"></div>
                            </div>
                            <span class="strength-text">Password strength</span>
                        </div>
                        <span class="password-requirement">Password must be at least 8 characters</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirm_password">Confirm New Password</label>
                        <div class="input-wrapper">
                            <i class="fas fa-check-circle input-icon"></i>
                            <input type="password" id="confirm_password" name="confirm_password" class="form-control" required>
                            <button type="button" class="password-toggle" data-target="confirm_password">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn-update">
                        <i class="fas fa-key"></i>
                        Update Password
                    </button>
                </form>
                
                <div class="password-tips">
                    <div class="tips-header">
                        <i class="fas fa-lightbulb tips-icon"></i>
                        <h4>Password Tips</h4>
                    </div>
                    <ul>
                        <li>Use a mixture of letters, numbers, and special characters</li>
                        <li>Avoid using easily guessable information like your name or birthdate</li>
                        <li>Use a different password for each of your important accounts</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .profile-section {
        max-width: 1100px;
        margin: 20px auto 50px;
    }
    
    /* Header styles */
    .profile-header-container {
        position: relative;
        height: 220px;
        border-radius: 20px;
        overflow: hidden;
        margin-bottom: 30px;
        background: linear-gradient(135deg, #1e2a40, #121a29);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    }
    
    .profile-header-overlay {
        position: absolute;
        width: 100%;
        height: 100%;
        background: url('https://assets.website-files.com/5e51c674258ffe10d286d30a/5e535a271f1535ff990fec11_petern.svg') center/cover;
        opacity: 0.05;
        top: 0;
        left: 0;
    }
    
    .profile-header-content {
        position: relative;
        padding: 30px;
        display: flex;
        align-items: center;
        gap: 25px;
        height: 100%;
    }
    
    .profile-avatar-wrapper {
        position: relative;
    }
    
    .profile-avatar {
        width: 120px;
        height: 120px;
        background: linear-gradient(135deg, #0066ff, #00a3ff);
        border-radius: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 10px 20px rgba(0, 102, 255, 0.3);
        border: 3px solid rgba(255, 255, 255, 0.1);
    }
    
    .profile-avatar i {
        font-size: 50px;
        color: white;
    }
    
    .avatar-status {
        position: absolute;
        bottom: -8px;
        right: -8px;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: #ff5e62;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        border: 3px solid #121a29;
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
    }
    
    .avatar-status.connected {
        background: #28a745;
    }
    
    .profile-info {
        flex-grow: 1;
    }
    
    .profile-info h1 {
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 5px;
        color: white;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        background: linear-gradient(90deg, #ffffff, #b8c6db);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
    
    .profile-email {
        color: rgba(255, 255, 255, 0.7);
        font-size: 16px;
        margin-bottom: 15px;
    }
    
    .profile-badges {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .profile-badge {
        display: inline-block;
        padding: 5px 12px;
        border-radius: 30px;
        font-size: 13px;
        font-weight: 600;
        background: rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.8);
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
    }
    
    .profile-badge.admin {
        background: linear-gradient(135deg, rgba(255, 94, 98, 0.3), rgba(255, 153, 102, 0.3));
        color: #ff5e62;
        border: 1px solid rgba(255, 94, 98, 0.3);
    }
    
    .profile-badge.premium {
        background: linear-gradient(135deg, rgba(255, 184, 0, 0.3), rgba(255, 153, 0, 0.3));
        color: #ffb800;
        border: 1px solid rgba(255, 184, 0, 0.3);
    }
    
    .profile-badge.standard {
        background: linear-gradient(135deg, rgba(0, 102, 255, 0.3), rgba(0, 163, 255, 0.3));
        color: #0066ff;
        border: 1px solid rgba(0, 102, 255, 0.3);
    }
    
    .profile-badge.unique-id {
        background: rgba(60, 60, 80, 0.3);
        color: rgba(255, 255, 255, 0.7);
        font-family: monospace;
        font-size: 12px;
    }
    
    .profile-badge.premium-expiry {
        background: linear-gradient(135deg, rgba(255, 184, 0, 0.2), rgba(255, 153, 0, 0.2));
        color: #ffa600;
        border: 1px solid rgba(255, 184, 0, 0.2);
        font-size: 12px;
    }
    
    /* Stats wrapper */
    .profile-stats-wrapper {
        margin-bottom: 30px;
        padding: 0 10px;
    }
    
    .stat-item {
        background: rgba(20, 20, 20, 0.7);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-radius: 16px;
        padding: 20px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        height: 100%;
        transition: all 0.3s ease;
    }
    
    .stat-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        border-color: rgba(0, 102, 255, 0.2);
    }
    
    .stat-icon-wrapper {
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, rgba(0, 102, 255, 0.2), rgba(0, 163, 255, 0.2));
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 15px;
        flex-shrink: 0;
    }
    
    .stat-icon-wrapper i {
        font-size: 22px;
        color: #0066ff;
    }
    
    .stat-info {
        display: flex;
        flex-direction: column;
    }
    
    .stat-label {
        color: var(--text-secondary);
        font-size: 14px;
        margin-bottom: 5px;
    }
    
    .stat-value {
        font-size: 22px;
        font-weight: 700;
        color: white;
    }
    
    /* Tabs system */
    .profile-tabs {
        margin-bottom: 30px;
        position: relative;
    }
    
    .tab-navigation {
        display: flex;
        background: rgba(20, 20, 20, 0.7);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-radius: 16px;
        padding: 10px;
        margin-bottom: 25px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        gap: 10px;
    }
    
    .tab-btn {
        flex: 1;
        background: transparent;
        border: none;
        color: var(--text-secondary);
        padding: 12px 15px;
        border-radius: 10px;
        font-size: 15px;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .tab-btn:hover {
        background: rgba(255, 255, 255, 0.05);
        color: white;
    }
    
    .tab-btn.active {
        background: rgba(0, 102, 255, 0.1);
        color: #0066ff;
    }
    
    .tab-btn i {
        font-size: 14px;
    }
    
    .tab-content {
        display: none;
    }
    
    .tab-content.active {
        display: block;
        animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    /* Glass cards */
    .glass-card {
        background: rgba(20, 20, 20, 0.7);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 25px;
        margin-bottom: 25px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
    }
    
    /* Connection card styles */
    .connection-card {
        margin-bottom: 30px;
    }
    
    .connection-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .connection-status-badge {
        display: flex;
        align-items: center;
        gap: 8px;
        background: rgba(255, 94, 98, 0.1);
        color: #ff5e62;
        padding: 8px 15px;
        border-radius: 30px;
        font-size: 14px;
        font-weight: 600;
    }
    
    .connection-status-badge.connected {
        background: rgba(25, 135, 84, 0.1);
        color: #28a745;
    }
    
    .section-title {
        font-size: 22px;
        font-weight: 600;
        color: white;
        display: flex;
        align-items: center;
        gap: 10px;
        margin: 0;
    }
    
    .section-title i {
        font-size: 18px;
        color: #0066ff;
    }
    
    .connection-body {
        display: grid;
        grid-template-columns: 1fr 60px 1fr;
        gap: 0;
    }
    
    .connection-code-box {
        background: rgba(30, 30, 30, 0.5);
        border-radius: 16px;
        padding: 25px;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .code-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .code-header h3 {
        font-size: 18px;
        font-weight: 600;
        margin: 0;
        color: white;
    }
    
    .code-actions {
        display: flex;
        gap: 10px;
    }
    
    .action-btn {
        display: flex;
        align-items: center;
        gap: 8px;
        height: 42px;
        padding: 0 16px;
        background: rgba(0, 102, 255, 0.1);
        color: #0066ff;
        border: 1px solid rgba(0, 102, 255, 0.2);
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .action-btn:hover {
        background: rgba(0, 102, 255, 0.15);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0, 102, 255, 0.1);
    }
    
    .action-btn i {
        font-size: 16px;
    }
    
    .copy-btn {
        display: flex;
        align-items: center;
        gap: 8px;
        background: rgba(0, 102, 255, 0.1);
        color: #0066ff;
        border: 1px solid rgba(0, 102, 255, 0.2);
        padding: 8px 12px;
        border-radius: 8px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .copy-btn:hover {
        background: rgba(0, 102, 255, 0.2);
    }
    
    .connection-code-display {
        background: rgba(20, 20, 20, 0.5);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        border: 1px solid rgba(0, 102, 255, 0.3);
        text-align: center;
    }
    
    .connection-code {
        font-family: monospace;
        font-size: 24px;
        font-weight: 700;
        letter-spacing: 2px;
        color: #0066ff;
    }
    
    .connection-instructions {
        background: rgba(20, 20, 20, 0.3);
        border-radius: 12px;
        padding: 20px;
    }
    
    .connection-instructions ol {
        margin: 0;
        padding-left: 25px;
        color: var(--text-secondary);
        font-size: 14px;
        line-height: 1.6;
    }
    
    .connection-instructions li {
        margin-bottom: 10px;
    }
    
    .connection-instructions li:last-child {
        margin-bottom: 0;
    }
    
    .divider {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .divider::before {
        content: '';
        position: absolute;
        top: 0;
        bottom: 0;
        left: 50%;
        width: 1px;
        background: rgba(255, 255, 255, 0.1);
    }
    
    .divider span {
        position: absolute;
        background: #1a1a1a;
        padding: 10px;
        color: rgba(255, 255, 255, 0.5);
        font-size: 12px;
        font-weight: 600;
        border-radius: 50%;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .qr-connection {
        background: rgba(30, 30, 30, 0.5);
        border-radius: 16px;
        padding: 25px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }
    
    .qr-header {
        text-align: center;
        margin-bottom: 20px;
    }
    
    .qr-header h3 {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 5px;
        color: white;
    }
    
    .qr-header p {
        color: var(--text-secondary);
        font-size: 14px;
        margin: 0;
    }
    
    .qr-code-container {
        width: 180px;
        height: 180px;
    }
    
    .qr-code-placeholder {
        width: 100%;
        height: 100%;
        background: rgba(20, 20, 20, 0.5);
        border-radius: 12px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 10px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .qr-code-placeholder i {
        font-size: 50px;
        color: var(--text-secondary);
    }
    
    .qr-code-placeholder span {
        font-size: 14px;
        color: var(--text-secondary);
    }
    
    /* Stats card styles */
    .stats-card {
        overflow: hidden;
    }
    
    .stats-header {
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .last-session-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }
    
    .last-game {
        background: rgba(30, 30, 30, 0.5);
        border-radius: 16px;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .game-image {
        height: 120px;
        overflow: hidden;
    }
    
    .game-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }
    
    .last-game:hover .game-image img {
        transform: scale(1.05);
    }
    
    .game-info {
        padding: 15px;
    }
    
    .game-info h3 {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 10px;
        color: white;
    }
    
    .session-meta {
        display: flex;
        gap: 15px;
    }
    
    .meta-item {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--text-secondary);
        font-size: 14px;
    }
    
    .activity-chart {
        background: rgba(30, 30, 30, 0.5);
        border-radius: 16px;
        padding: 20px;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .activity-chart h3 {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 20px;
        color: white;
        text-align: center;
    }
    
    .chart-placeholder {
        height: 150px;
        display: flex;
        align-items: flex-end;
        gap: 15px;
        margin-bottom: 10px;
        padding: 0 10px;
    }
    
    .chart-bar {
        flex: 1;
        background: rgba(0, 102, 255, 0.2);
        border-radius: 5px 5px 0 0;
        transition: all 0.3s ease;
    }
    
    .chart-bar:hover {
        background: rgba(0, 102, 255, 0.4);
    }
    
    .chart-bar.active {
        background: rgba(0, 102, 255, 0.6);
    }
    
    .chart-labels {
        display: flex;
        justify-content: space-between;
        color: var(--text-secondary);
        font-size: 12px;
        padding: 0 10px;
    }
    
    .empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 50px 20px;
        color: var(--text-secondary);
    }
    
    .empty-state i {
        font-size: 50px;
        margin-bottom: 15px;
        color: rgba(255, 255, 255, 0.1);
    }
    
    .empty-state h3 {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 10px;
        color: white;
    }
    
    .empty-state p {
        font-size: 14px;
        max-width: 400px;
        margin: 0 auto;
    }
    
    /* Form styles */
    .profile-form {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }
    
    .form-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .form-group label {
        font-size: 14px;
        font-weight: 500;
    }
    
    .input-wrapper {
        position: relative;
        display: flex;
        align-items: center;
    }
    
    .input-wrapper i {
        position: absolute;
        left: 15px;
        color: var(--text-secondary);
    }
    
    .form-control {
        width: 100%;
        padding: 12px 15px 12px 45px;
        background: rgba(30, 30, 30, 0.7);
        border: 1px solid var(--border);
        border-radius: 8px;
        color: var(--text);
        font-size: 15px;
        transition: all 0.3s ease;
    }
    
    .form-control:focus {
        border-color: var(--primary);
        outline: none;
        box-shadow: 0 0 0 2px rgba(0, 102, 255, 0.2);
    }
    
    .form-actions {
        margin-top: 10px;
    }
    
    .btn-primary {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        width: 100%;
        padding: 12px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
        background: #0052cc;
    }
    
    .btn-secondary {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 10px 16px;
        background: rgba(30, 30, 30, 0.7);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .btn-secondary:hover {
        background: rgba(40, 40, 40, 0.7);
    }
    
    /* Alert styles */
    .alert {
        padding: 12px 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 14px;
    }
    
    .alert-danger {
        background-color: rgba(220, 53, 69, 0.1);
        color: #ff6b7d;
        border: 1px solid rgba(220, 53, 69, 0.2);
    }
    
    .alert-success {
        background-color: rgba(25, 135, 84, 0.1);
        color: #28a745;
        border: 1px solid rgba(25, 135, 84, 0.2);
    }
    
    /* Responsive styles */
    @media (max-width: 992px) {
        .connection-body {
            grid-template-columns: 1fr;
        }
        
        .divider {
            display: flex;
            height: 60px;
        }
        
        .divider::before {
            width: 100%;
            height: 1px;
            left: 0;
            top: 50%;
        }
        
        .last-session-container {
            grid-template-columns: 1fr;
        }
    }
    
    @media (max-width: 768px) {
        .profile-header-content {
            flex-direction: column;
            text-align: center;
        }
        
        .profile-badges {
            justify-content: center;
        }
        
        .profile-avatar {
            margin: 0 auto;
        }
        
        .profile-info h1 {
            font-size: 24px;
        }
        
        .tab-btn span {
            display: none;
        }
        
        .tab-btn i {
            font-size: 18px;
        }
    }

    /* Styles for notifications */
    .alert {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        display: flex;
        align-items: center;
        max-width: 400px;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }

    .alert-icon {
        margin-right: 15px;
        font-size: 20px;
    }

    .alert-content {
        flex-grow: 1;
    }

    .alert-close {
        background: transparent;
        border: none;
        cursor: pointer;
        color: inherit;
        opacity: 0.7;
        padding: 0;
        margin-left: 15px;
    }

    .alert-close:hover {
        opacity: 1;
    }

    /* Styles for device list */
    .devices-container {
        margin-top: 20px;
    }

    /* Styles for device cards */
    .device-item {
        display: flex;
        align-items: center;
        background: rgba(25, 25, 35, 0.4);
        border-radius: 12px;
        margin-bottom: 15px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .device-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 60px;
        height: 60px;
        font-size: 24px;
        color: #0066ff;
        background: rgba(0, 102, 255, 0.1);
        border-radius: 12px;
        margin-right: 18px;
        flex-shrink: 0;
    }
    
    .device-info {
        flex-grow: 1;
    }
    
    .device-header {
        margin-bottom: 5px;
    }
    
    .device-title-line {
        display: flex;
        align-items: center;
        gap: 8px;
        height: 34px;
    }
    
    .device-name {
        font-style: normal;   
        font-size: 16px;
        font-weight: 600;
        margin: 0;
        padding: 0;
        display: flex;
        align-items: center;
        line-height: 1;
    }
    
    .device-primary-badge {
        margin: 0;
    }
    
    .device-primary-badge .badge, 
    .device-status .badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        height: 24px;
        padding: 0 10px;
        font-size: 12px;
        font-weight: 500;
        line-height: 1;
    }
    
    .device-primary-badge .badge {
        background-color: #0066ff;
        color: white;
        border-radius: 30px;
        box-shadow: 0 2px 5px rgba(0, 102, 255, 0.2);
    }
    
    .device-status .badge {
        border-radius: 20px;
    }
    
    .device-status .badge.bg-success {
        background-color: #28a745;
        box-shadow: 0 2px 4px rgba(40, 167, 69, 0.2);
    }
    
    .device-status .badge.bg-secondary {
        background-color: #6c757d;
        box-shadow: 0 2px 4px rgba(108, 117, 125, 0.2);
    }
    
    .device-meta {
        display: flex;
        gap: 15px;
        color: rgba(255, 255, 255, 0.6);
        font-size: 13px;
        margin-bottom: 8px;
        align-items: center;
    }
    
    .device-meta span {
        position: relative;
    }
    
    .device-meta span:not(:last-child):after {
        content: "";
        position: absolute;
        right: -8px;
        top: 50%;
        transform: translateY(-50%);
        width: 1px;
        height: 10px;
        background-color: rgba(255, 255, 255, 0.2);
    }
    
    .device-connection-time {
        color: rgba(255, 255, 255, 0.6);
        font-size: 13px;
    }
    
    .connection-label {
        opacity: 0.7;
    }
    
    /* Device action buttons */
    .device-actions {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-left: auto;
        flex-shrink: 0;
    }
    
    .disconnect-device {
        height: 38px;
        padding: 0 16px;
        background: rgba(220, 53, 69, 0.1);
        color: #dc3545;
        border: 1px solid rgba(220, 53, 69, 0.2);
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .disconnect-device:hover {
        background: rgba(220, 53, 69, 0.15);
    }
    
    .reset-hwid-device {
        width: 38px;
        height: 38px;
        background: rgba(255, 193, 7, 0.1);
        color: #ffc107;
        border: 1px solid rgba(255, 193, 7, 0.2);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .reset-hwid-device:hover {
        background: rgba(255, 193, 7, 0.15);
    }

    .loading-devices {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 30px;
        text-align: center;
        color: var(--text-secondary);
    }

    .spinner {
        width: 40px;
        height: 40px;
        border: 3px solid rgba(0, 102, 255, 0.2);
        border-top-color: #0066ff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 15px;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* Slots tab styles */
    .slots-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .slots-counter {
        display: flex;
        align-items: center;
        gap: 10px;
        background: rgba(0, 102, 255, 0.1);
        padding: 8px 15px;
        border-radius: 30px;
        color: #0066ff;
        font-weight: 600;
    }

    .slots-label {
        font-size: 14px;
    }

    .slots-value {
        font-size: 18px;
    }

    .no-slots-container,
    .no-sessions-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 50px 20px;
        color: var(--text-secondary);
    }

    .no-slots-icon,
    .no-sessions-icon {
        width: 80px;
        height: 80px;
        background: rgba(0, 102, 255, 0.1);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 20px;
    }

    .no-slots-icon i,
    .no-sessions-icon i {
        font-size: 32px;
        color: #0066ff;
    }

    .no-slots-container h3,
    .no-sessions-container h3 {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 10px;
        color: white;
    }

    .no-slots-container p,
    .no-sessions-container p {
        font-size: 14px;
        max-width: 400px;
        margin: 0 auto;
    }

    .active-sessions-container {
        margin-top: 20px;
    }

    .slots-list {
        padding: 10px 0;
    }

    .slot-item {
        display: flex;
        align-items: stretch;
        padding: 15px;
        background: rgba(25, 25, 35, 0.4);
        border-radius: 8px;
        margin-bottom: 10px;
    }
    
    .slot-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 60px;
        font-size: 22px;
        color: #0066ff;
    }
    
    .slot-info {
        flex-grow: 1;
        padding-right: 15px;
    }
    
    .slot-name {
        font-size: 16px;
        font-weight: 600;
        margin: 0 0 5px;
    }
    
    .slot-expires {
        font-size: 13px;
        color: #ffa600;
    }
    
    .slot-expires.permanent {
        color: #28a745;
    }
    
    .no-slots-message {
        text-align: center;
        padding: 20px;
        color: var(--text-secondary);
    }

    .active-sessions-container {
        margin-top: 20px;
    }

    /* Subscription tab styles */
    .subscription-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .subscription-status-badge {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 15px;
        border-radius: 30px;
        font-size: 14px;
        font-weight: 600;
    }
    
    .subscription-status-badge.premium {
        background: linear-gradient(135deg, rgba(255, 184, 0, 0.2), rgba(255, 153, 0, 0.2));
        color: #ffb800;
        border: 1px solid rgba(255, 184, 0, 0.3);
    }
    
    .subscription-status-badge.admin {
        background: linear-gradient(135deg, rgba(255, 94, 98, 0.2), rgba(255, 153, 102, 0.2));
        color: #ff5e62;
        border: 1px solid rgba(255, 94, 98, 0.3);
    }
    
    .subscription-status-badge.standard {
        background: linear-gradient(135deg, rgba(0, 102, 255, 0.2), rgba(0, 163, 255, 0.2));
        color: #0066ff;
        border: 1px solid rgba(0, 102, 255, 0.3);
    }
    
    .subscription-details {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 25px;
    }
    
    .detail-item {
        background: rgba(30, 30, 30, 0.5);
        border-radius: 12px;
        padding: 20px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        display: flex;
        align-items: flex-start;
        gap: 15px;
        transition: all 0.3s ease;
    }
    
    .detail-item:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        border-color: rgba(0, 102, 255, 0.2);
    }
    
    .detail-icon {
        width: 40px;
        height: 40px;
        background: rgba(0, 102, 255, 0.1);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }
    
    .detail-icon i {
        font-size: 18px;
        color: #0066ff;
    }
    
    .detail-content {
        flex-grow: 1;
    }
    
    .detail-content h3 {
        font-size: 16px;
        font-weight: 600;
        color: white;
        margin-bottom: 8px;
    }
    
    .detail-content p {
        color: var(--text-secondary);
        font-size: 14px;
        margin: 0;
    }
    
    .premium-text {
        color: #ffb800 !important;
        font-weight: 500;
    }
    
    .expiry-date {
        color: #ffa600 !important;
    }
    
    .permanent-badge {
        color: #28a745 !important;
        display: flex;
        align-items: center;
        gap: 5px;
        font-weight: 500;
    }
    
    .benefits-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .benefits-list li {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--text-secondary);
        font-size: 14px;
        margin-bottom: 8px;
    }
    
    .benefits-list li:last-child {
        margin-bottom: 0;
    }
    
    .benefits-list li i {
        color: #28a745;
        font-size: 12px;
    }
    
    .upgrade-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 40px 20px;
    }
    
    .upgrade-icon {
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, rgba(255, 184, 0, 0.2), rgba(255, 153, 0, 0.2));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 20px;
    }
    
    .upgrade-icon i {
        font-size: 32px;
        color: #ffb800;
    }
    
    .upgrade-container h3 {
        font-size: 22px;
        font-weight: 600;
        margin-bottom: 10px;
        color: white;
    }
    
    .upgrade-container p {
        font-size: 15px;
        color: var(--text-secondary);
        max-width: 450px;
        margin: 0 auto 25px;
    }
    
    .btn-premium {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        background: linear-gradient(135deg, #ffb800, #ff8a00);
        color: white;
        padding: 12px 25px;
        border-radius: 30px;
        font-size: 16px;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(255, 184, 0, 0.3);
    }
    
    .btn-premium:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(255, 184, 0, 0.4);
        color: white;
    }
    
    /* Subscription history styles */
    .history-list {
        margin-top: 20px;
    }
    
    .history-item {
        display: flex;
        align-items: flex-start;
        gap: 15px;
        background: rgba(30, 30, 30, 0.5);
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 15px;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .history-icon {
        width: 36px;
        height: 36px;
        background: rgba(0, 102, 255, 0.1);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }
    
    .history-icon i {
        font-size: 16px;
        color: #0066ff;
    }
    
    .history-content {
        flex-grow: 1;
    }
    
    .history-date {
        font-size: 12px;
        color: var(--text-secondary);
        margin-bottom: 5px;
    }
    
    .history-title {
        font-size: 15px;
        font-weight: 600;
        color: white;
        margin-bottom: 5px;
    }
    
    .history-details {
        font-size: 13px;
        color: var(--text-secondary);
    }
    
    .empty-history {
        text-align: center;
        padding: 30px;
        color: var(--text-secondary);
        font-style: italic;
    }
    
    /* Enhanced slot styles */
    .slot-source {
        font-size: 12px;
        color: var(--text-secondary);
        margin-top: 5px;
    }

    /* Enhanced slot styles in subscription details */
    .slot-summary {
        margin-top: 8px;
    }
    
    .slot-item-small {
        background: rgba(30, 30, 30, 0.3);
        border-radius: 8px;
        padding: 8px 12px;
        margin-bottom: 8px;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .slot-name-small {
        font-size: 13px;
        font-weight: 500;
        color: white;
        display: block;
        margin-bottom: 4px;
    }

    /* Media queries for responsive behavior */
    @media (max-width: 992px) {
        .subscription-details {
            grid-template-columns: 1fr;
        }
    }

    /* Enhanced slot styles in subscription details */
    .slot-count {
        color: var(--text-secondary);
        margin-bottom: 15px;
        font-size: 14px;
    }
    
    .slots-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 10px;
    }
    
    .slot-card {
        background: rgba(0, 102, 255, 0.1);
        border-radius: 10px;
        overflow: hidden;
        border: 1px solid rgba(0, 102, 255, 0.2);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .slot-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .slot-header {
        background: rgba(0, 102, 255, 0.2);
        padding: 8px 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }
    
    .slot-number {
        font-size: 18px;
        font-weight: 700;
        color: #0066ff;
        margin-right: 5px;
    }
    
    .slot-label {
        font-size: 14px;
        color: rgba(255, 255, 255, 0.7);
    }
    
    .slot-body {
        padding: 10px;
        text-align: center;
    }
    
    .slot-expiry {
        font-size: 12px;
        color: #ffa600;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 5px;
    }
    
    .slot-expiry.permanent {
        color: #28a745;
    }
    
    .slot-item-small {
        background: rgba(30, 30, 30, 0.3);
        border-radius: 8px;
        padding: 8px 12px;
        margin-bottom: 8px;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .slot-name-small {
        font-size: 13px;
        font-weight: 500;
        color: white;
        display: block;
        margin-bottom: 4px;
    }

    /* Download box styles */
    .download-box {
        background: rgba(30, 30, 30, 0.5);
        border-radius: 16px;
        padding: 25px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        display: flex;
        flex-direction: column;
    }
    
    .download-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .download-header h3 {
        font-size: 18px;
        font-weight: 600;
        margin: 0;
        color: white;
    }
    
    .download-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
    }
    
    .download-icon {
        width: 80px;
        height: 80px;
        background: rgba(0, 102, 255, 0.1);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 20px;
    }
    
    .download-icon i {
        font-size: 36px;
        color: #0066ff;
    }
    
    .download-text {
        color: var(--text-secondary);
        font-size: 15px;
        margin-bottom: 25px;
        max-width: 280px;
    }
    
    .download-actions {
        margin-top: auto;
    }
    
    .download-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #0066ff, #00a3ff);
        color: white;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        border: none;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(0, 102, 255, 0.3);
    }
    
    .download-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 102, 255, 0.4);
    }
    
    .dropdown-menu-dark {
        background: rgba(25, 25, 35, 0.95);
        border-color: rgba(255, 255, 255, 0.1);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    .dropdown-item {
        color: rgba(255, 255, 255, 0.8);
        padding: 10px 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .dropdown-item:hover {
        background: rgba(0, 102, 255, 0.2);
        color: white;
    }

    /* Align user form styles */
    .align-user-section {
        background: rgba(30, 30, 30, 0.4);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .align-user-form .input-group {
        display: flex;
        gap: 10px;
    }
    
    .align-user-form .form-control {
        background: rgba(20, 20, 20, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: white;
        padding: 12px 15px;
        border-radius: 8px;
        font-size: 14px;
    }
    
    .align-user-form .form-control:focus {
        border-color: rgba(0, 102, 255, 0.4);
        box-shadow: 0 0 0 2px rgba(0, 102, 255, 0.2);
    }
    
    .align-user-form .btn-primary {
        display: flex;
        align-items: center;
        gap: 8px;
        background: #0066ff;
        border: none;
        padding: 12px 20px;
        border-radius: 8px;
        font-weight: 600;
        white-space: nowrap;
    }
    
    .align-user-error {
        color: #dc3545;
    }
    
    /* Slot status and actions */
    .slot-actions {
        margin-left: auto;
        display: flex;
        align-items: center;
    }
    
    .slot-status {
        display: flex;
        align-items: center;
    }
    
    .assigned-user {
        display: flex;
        align-items: center;
        gap: 8px;
        background: rgba(40, 167, 69, 0.1);
        padding: 6px 10px;
        border-radius: 20px;
        border: 1px solid rgba(40, 167, 69, 0.2);
    }
    
    .user-badge {
        color: #28a745;
        font-size: 13px;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .remove-user-btn {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(220, 53, 69, 0.1);
        color: #dc3545;
        border: 1px solid rgba(220, 53, 69, 0.2);
        cursor: pointer;
        transition: all 0.2s ease;
        padding: 0;
        font-size: 10px;
    }
    
    .remove-user-btn:hover {
        background: rgba(220, 53, 69, 0.2);
    }
    
    .empty-slot-badge {
        background: rgba(108, 117, 125, 0.1);
        color: #6c757d;
        padding: 6px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
        border: 1px solid rgba(108, 117, 125, 0.2);
    }

    .align-user-error {
        color: #dc3545;
    }
    
    .no-slots-available {
        background: rgba(255, 193, 7, 0.1);
        border: 1px solid rgba(255, 193, 7, 0.2);
    }
    
    .no-slots-message {
        display: flex;
        align-items: center;
        gap: 15px;
        color: #e0a800;
    }
    
    .no-slots-message i {
        font-size: 24px;
    }
    
    .no-slots-message p {
        margin: 0;
        font-size: 14px;
    }

    .user-status {
        font-size: 10px;
        padding: 2px 6px;
        border-radius: 10px;
        margin-left: 5px;
        text-transform: uppercase;
        font-weight: 600;
    }
    
    .user-status.premium {
        background: rgba(40, 167, 69, 0.2);
        color: #28a745;
    }
    
    .user-status.standard {
        background: rgba(108, 117, 125, 0.2);
        color: #6c757d;
    }
    
    .user-status.admin {
        background: rgba(220, 53, 69, 0.2);
        color: #dc3545;
    }

    /* Toast notifications */
    .toast {
        position: fixed;
        bottom: 30px;
        right: 30px;
        padding: 15px 20px;
        background: rgba(25, 25, 25, 0.9);
        backdrop-filter: blur(10px);
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        display: flex;
        align-items: center;
        gap: 12px;
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.3s ease;
        z-index: 1000;
        max-width: 350px;
        color: white;
    }
    
    .toast.show {
        opacity: 1;
        transform: translateY(0);
    }
    
    .toast-icon {
        font-size: 18px;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .toast-content {
        font-size: 14px;
        font-weight: 500;
    }
    
    .toast-success .toast-icon {
        color: #28a745;
    }
    
    .toast-error .toast-icon {
        color: #dc3545;
    }
    
    .toast-info .toast-icon {
        color: #0dcaf0;
    }

    .slot-assign-form {
        display: flex;
        align-items: center;
        gap: 5px;
        width: 100%;
    }
    
    .slot-input {
        flex: 1;
        background: rgba(20, 20, 20, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: white;
        padding: 6px 10px;
        border-radius: 8px;
        font-size: 13px;
        min-width: 120px;
    }
    
    .slot-input:focus {
        border-color: rgba(0, 102, 255, 0.4);
        box-shadow: 0 0 0 2px rgba(0, 102, 255, 0.2);
        outline: none;
    }
    
    .slot-assign-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(0, 102, 255, 0.1);
        color: #0066ff;
        border: 1px solid rgba(0, 102, 255, 0.2);
        border-radius: 8px;
        width: 32px;
        height: 32px;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .slot-assign-btn:hover {
        background: rgba(0, 102, 255, 0.2);
    }

    .aligned-by-info {
        background: rgba(0, 102, 255, 0.1);
        border-radius: 8px;
        padding: 8px 12px;
        font-size: 14px;
        color: #fff;
        display: flex;
        align-items: center;
        gap: 8px;
        border: 1px solid rgba(0, 102, 255, 0.2);
    }

    .aligned-by-info i {
        color: #0066ff;
    }

    .aligned-badge {
        background: linear-gradient(135deg, rgba(0, 102, 255, 0.2), rgba(0, 163, 255, 0.2));
        display: inline-flex;
        align-items: center;
        gap: 5px;
        padding: 5px 10px;
        border-radius: 30px;
        font-size: 14px;
        color: #0066ff;
        font-weight: 600;
    }

    .aligned-badge i {
        font-size: 12px;
    }

    .disalign-self-btn {
        margin-left: auto;
        background: rgba(255, 94, 98, 0.1);
        color: #ff5e62;
        border: 1px solid rgba(255, 94, 98, 0.2);
        border-radius: 4px;
        padding: 4px 8px;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .disalign-self-btn:hover {
        background: rgba(255, 94, 98, 0.2);
    }

    /* Promo code section styling - minimal gaps */
    .promo-card {
        overflow: hidden;
        padding: 0;
        border: 1px solid rgba(0, 102, 255, 0.2);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25);
    }
    
    .promo-content {
        display: flex;
        flex-direction: row;
        min-height: 180px;
    }
    
    .promo-left {
        flex: 1.3;
        padding: 20px;
        background: rgba(12, 19, 33, 0.7);
        border-right: 1px solid rgba(0, 102, 255, 0.2);
        display: flex;
        flex-direction: column;
    }
    
    .promo-right {
        flex: 1;
        padding: 20px;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        background: rgba(15, 23, 42, 0.5);
    }
    
    .promo-title {
        font-size: 22px;
        font-weight: 700;
        margin-bottom: 8px;
        color: #fff;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .promo-title i {
        color: #0066ff;
        font-size: 20px;
    }
    
    .promo-subtitle {
        color: rgba(255, 255, 255, 0.7);
        font-size: 14px;
        margin-bottom: 10px;
    }
    
    .promo-form {
        margin-top: 8px;
        width: 100%;
    }
    
    .promo-input-container {
        display: flex;
        position: relative;
        width: 100%;
    }
    
    .promo-input {
        width: 100%;
        height: 48px;
        background: rgba(15, 15, 20, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 0 55px 0 15px;
        color: white;
        font-size: 15px;
        transition: all 0.3s ease;
    }
    
    .promo-input:focus {
        border-color: rgba(0, 102, 255, 0.4);
        outline: none;
        box-shadow: 0 0 0 2px rgba(0, 102, 255, 0.15);
    }
    
    .promo-input::placeholder {
        color: rgba(255, 255, 255, 0.3);
    }
    
    .promo-btn {
        position: absolute;
        right: 4px;
        top: 4px;
        bottom: 4px;
        width: 40px;
        border-radius: 6px;
        background: linear-gradient(135deg, #0066ff, #0052cc);
        color: white;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .promo-btn:hover {
        background: linear-gradient(135deg, #0052cc, #003d99);
        transform: translateY(-1px);
    }
    
    .promo-info-section {
        margin-bottom: 0;
    }
    
    .promo-info-title {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 8px;
        color: #fff;
    }
    
    .promo-info-text {
        color: rgba(255, 255, 255, 0.7);
        font-size: 15px;
        line-height: 1.5;
        margin: 0;
    }
    
    .promo-link {
        color: #0066ff;
        text-decoration: none;
        font-weight: 500;
        transition: all 0.2s ease;
    }
    
    .promo-link:hover {
        color: #0084ff;
        text-decoration: underline;
    }
    
    @media (max-width: 768px) {
        .promo-content {
            flex-direction: column;
            min-height: auto;
        }
        
        .promo-left, .promo-right {
            width: 100%;
            padding: 15px;
        }
        
        .promo-left {
            border-right: none;
            border-bottom: 1px solid rgba(0, 102, 255, 0.1);
        }
        
        .promo-form {
            margin-top: 8px;
            margin-bottom: 0;
        }
    }

    /* Settings tab styles */
    .settings-container {
        margin-bottom: 20px;
    }

    .settings-header {
        display: flex;
        margin-bottom: 25px;
    }

    .settings-icon {
        color: #0066ff;
        font-size: 22px;
        margin-right: 12px;
        margin-top: 2px;
    }

    .settings-info {
        flex-grow: 1;
    }
    
    .settings-info h3 {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 5px;
        color: #fff;
    }
    
    .settings-info p {
        color: rgba(255, 255, 255, 0.7);
        font-size: 14px;
        margin: 0;
    }

    .settings-form {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .form-group label {
        font-size: 14px;
        font-weight: 500;
        color: rgba(255, 255, 255, 0.8);
    }

    .input-wrapper {
        position: relative;
        display: flex;
        align-items: center;
    }

    .input-wrapper i {
        position: absolute;
        left: 15px;
        color: rgba(255, 255, 255, 0.4);
    }

    .form-control {
        width: 100%;
        height: 48px;
        padding: 12px 15px 12px 45px;
        background: rgba(20, 20, 20, 0.7);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        color: white;
        font-size: 15px;
        transition: all 0.3s ease;
    }

    .form-control:focus {
        border-color: rgba(0, 102, 255, 0.4);
        outline: none;
        box-shadow: 0 0 0 2px rgba(0, 102, 255, 0.2);
    }

    .form-actions {
        margin-top: 10px;
    }

    .btn-update {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        width: 100%;
        height: 48px;
        background: #0066ff;
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        font-size: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .btn-update:hover {
        background: #0052cc;
    }
    
    /* Password strength meter */
    .password-strength {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 5px;
    }

    .strength-bar {
        height: 6px;
        flex-grow: 1;
        background: rgba(20, 20, 20, 0.7);
        border-radius: 10px;
        overflow: hidden;
    }

    .strength-indicator {
        height: 100%;
        background: linear-gradient(90deg, #5cb85c, #f0ad4e, #d9534f);
        border-radius: 10px;
    }

    .strength-text {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.6);
        min-width: 110px;
    }

    /* Security tips section */
    .security-tips {
        margin-top: 25px;
        padding: 20px;
        background: rgba(20, 20, 20, 0.5);
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .security-tips h4 {
        font-size: 16px;
        font-weight: 600;
        color: white;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .security-tips h4 i {
        color: #5cb85c;
    }

    .security-tips ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .security-tips li {
        font-size: 14px;
        color: rgba(255, 255, 255, 0.7);
        margin-bottom: 8px;
        padding-left: 20px;
        position: relative;
    }
    
    .security-tips li:last-child {
        margin-bottom: 0;
    }
    
    .security-tips li:before {
        content: "";
        position: absolute;
        left: 0;
        top: 7px;
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.4);
    }

    /* Security Settings Tab Styles */
    /* Main header */
    .security-settings-header {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .security-icon {
        color: #0066ff;
        font-size: 20px;
        margin-right: 10px;
    }
    
    /* Password management header */
    .password-management-header {
        display: flex;
        align-items: flex-start;
        margin-bottom: 25px;
    }
    
    .password-icon {
        color: #0066ff;
        font-size: 20px;
        margin-right: 12px;
        margin-top: 4px;
    }
    
    .password-management-header h3 {
        margin: 0 0 5px 0;
        font-size: 20px;
        font-weight: 600;
    }
    
    .password-subtitle {
        color: rgba(255, 255, 255, 0.7);
        font-size: 14px;
        margin: 0;
    }
    
    /* Form styles */
    .settings-form {
        display: flex;
        flex-direction: column;
        gap: 22px;
    }
    
    .form-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .form-group label {
        font-size: 14px;
        font-weight: 500;
        color: rgba(255, 255, 255, 0.8);
    }
    
    .input-wrapper {
        position: relative;
    }
    
    .input-icon {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: rgba(255, 255, 255, 0.4);
        font-size: 16px;
    }
    
    .form-control {
        width: 100%;
        height: 46px;
        background: rgba(15, 15, 20, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 6px;
        color: white;
        font-size: 15px;
        padding: 0 40px 0 40px;
        transition: all 0.2s ease;
    }
    
    .form-control:focus {
        outline: none;
        border-color: rgba(0, 102, 255, 0.5);
        box-shadow: 0 0 0 1px rgba(0, 102, 255, 0.2);
    }
    
    /* Password toggle */
    .password-toggle {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        background: transparent;
        border: none;
        padding: 0;
        color: rgba(255, 255, 255, 0.4);
        cursor: pointer;
        font-size: 18px;
    }
    
    .password-toggle:hover {
        color: #0066ff;
    }
    
    /* Password strength meter */
    .password-strength {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 6px;
    }
    
    .strength-meter {
        flex-grow: 1;
        height: 6px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 3px;
        overflow: hidden;
    }
    
    .strength-indicator {
        height: 100%;
        width: 70%;
        background: linear-gradient(90deg, #5cb85c, #f0ad4e, #d9534f);
        border-radius: 3px;
    }
    
    .strength-text {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.6);
        margin-left: 10px;
    }
    
    /* Update button */
    .btn-update {
        height: 46px;
        background: #0066ff;
        color: white;
        border: none;
        border-radius: 6px;
        font-weight: 600;
        font-size: 15px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        transition: background 0.2s ease;
        margin-top: 10px;
    }
    
    .btn-update:hover {
        background: #0057da;
    }
    
    /* Password tips section */
    .password-tips {
        margin-top: 30px;
        padding: 20px;
        background: rgba(15, 15, 20, 0.4);
        border-radius: 8px;
    }
    
    .tips-header {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
    }
    
    .tips-icon {
        color: #5cb85c;
        font-size: 18px;
        margin-right: 8px;
    }
    
    .password-tips h4 {
        margin: 0;
        font-size: 16px;
        font-weight: 600;
    }
    
    .password-tips ul {
        margin: 0;
        padding-left: 20px;
        list-style-type: disc;
    }
    
    .password-tips li {
        color: rgba(255, 255, 255, 0.7);
        font-size: 14px;
        margin-bottom: 7px;
        line-height: 1.4;
    }
    
    .password-tips li:last-child {
        margin-bottom: 0;
    }

    /* Alert system */
    .alert-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: rgba(25, 25, 35, 0.9);
        backdrop-filter: blur(10px);
        border-radius: 8px;
        min-width: 300px;
        max-width: 400px;
        padding: 15px 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 9999;
        transform: translateY(100px);
        opacity: 0;
        transition: transform 0.3s ease, opacity 0.3s ease;
    }
    
    .alert-container.show {
        transform: translateY(0);
        opacity: 1;
    }
    
    .alert-content {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .alert-content i {
        font-size: 18px;
    }
    
    .alert-container.success {
        background: rgba(40, 167, 69, 0.9);
        color: white;
    }
    
    .alert-container.error, .alert-container.danger {
        background: rgba(220, 53, 69, 0.9);
        color: white;
    }
    
    .alert-container.info {
        background: rgba(23, 162, 184, 0.9);
        color: white;
    }
    
    .alert-close {
        background: transparent;
        border: none;
        color: rgba(255, 255, 255, 0.7);
        font-size: 14px;
        cursor: pointer;
        padding: 5px;
        line-height: 1;
    }
    
    .alert-close:hover {
        color: white;
    }

    /* Security tips li:before {
        content: "";
        position: absolute;
        left: 0;
        top: 7px;
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.4);
    }

    /* Slot Alignment Details styles */
    .slot-alignment-details {
        margin-top: 10px;
        background: rgba(0, 102, 255, 0.05);
        border-radius: 8px;
        padding: 10px;
        font-size: 13px;
        color: rgba(255, 255, 255, 0.7);
        border: 1px solid rgba(0, 102, 255, 0.1);
    }
    
    .alignment-info, .alignment-history, .slot-created, .slot-source {
        margin-bottom: 5px;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .alignment-info i, .alignment-history i, .slot-created i, .slot-source i {
        color: #0066ff;
        font-size: 12px;
        width: 16px;
        text-align: center;
    }
    
    .days-aligned, .history-detail {
        margin-left: 3px;
        color: rgba(255, 255, 255, 0.5);
        font-style: italic;
    }
    
    .slot-alignment-details .alignment-info {
        color: #1da1f2;
    }
    
    .slot-alignment-details .alignment-history {
        color: #ff9900;
    }
    
    .slot-alignment-details .slot-created,
    .slot-alignment-details .slot-source {
        color: rgba(255, 255, 255, 0.6);
    }

    /* Expired slots user status */
    .ex-user-status {
        display: inline-block;
        font-size: 11px;
        padding: 2px 6px;
        border-radius: 10px;
        margin-left: 5px;
        text-transform: uppercase;
        font-weight: 600;
    }
    
    .ex-user-status.premium {
        background: rgba(40, 167, 69, 0.2);
        color: #28a745;
    }
    
    .ex-user-status.standard {
        background: rgba(108, 117, 125, 0.2);
        color: #6c757d;
    }
    
    .ex-user-status.admin {
        background: rgba(220, 53, 69, 0.2);
        color: #dc3545;
    }
    
    /* History summary styles */
    .history-summary {
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .summary-container {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        justify-content: flex-start;
        margin-top: 15px;
    }
    
    .summary-item {
        display: flex;
        align-items: center;
        gap: 10px;
        background: rgba(30, 30, 30, 0.5);
        border-radius: 10px;
        padding: 10px 15px;
        flex: 0 0 auto;
        min-width: 150px;
        transition: transform 0.2s ease;
    }
    
    .summary-item:hover {
        transform: translateY(-2px);
    }
    
    .summary-icon {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }
    
    .summary-icon.assigned {
        background: rgba(0, 102, 255, 0.1);
        color: #0066ff;
    }
    
    .summary-icon.freed {
        background: rgba(108, 117, 125, 0.1);
        color: #6c757d;
    }
    
    .summary-icon.expired {
        background: rgba(255, 193, 7, 0.1);
        color: #ffc107;
    }
    
    .summary-icon.granted {
        background: rgba(40, 167, 69, 0.1);
        color: #28a745;
    }
    
    .summary-icon.revoked {
        background: rgba(220, 53, 69, 0.1);
        color: #dc3545;
    }
    
    .summary-details {
        display: flex;
        flex-direction: column;
    }
    
    .summary-count {
        font-size: 18px;
        font-weight: 700;
        color: white;
    }
    
    .summary-label {
        font-size: 12px;
        color: rgba(255, 255, 255, 0.6);
        line-height: 1.2;
    }

    .device-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 5px;
    }
    
    .device-title-line {
        display: flex;
        align-items: center;
        gap: 8px;
        height: 34px;
    }
    
    .device-name {
        font-size: 16px;
        font-weight: 600;
        margin: 0;
        display: flex;
        align-items: center;
        line-height: 1;
    }
    
    .device-primary-badge {
        margin: 0;
    }
    
    .device-primary-badge .badge, 
    .device-status .badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        height: 24px;
        padding: 0 10px;
        font-size: 12px;
        font-weight: 500;
        line-height: 1;
    }
    
    .device-primary-badge .badge {
        background-color: #0066ff;
        color: white;
        border-radius: 30px;
        box-shadow: 0 2px 5px rgba(0, 102, 255, 0.2);
    }
    
    .device-status .badge {
        border-radius: 20px;
    }
    
    .device-status .badge.bg-success {
        background-color: #28a745;
        box-shadow: 0 2px 4px rgba(40, 167, 69, 0.2);
    }
    
    .device-status .badge.bg-secondary {
        background-color: #6c757d;
        box-shadow: 0 2px 4px rgba(108, 117, 125, 0.2);
    }
    
    .device-actions {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .action-btn {
        height: 38px;
        padding: 0 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .action-btn-icon {
        width: 38px;
        height: 38px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        border: 1px solid rgba(0, 102, 255, 0.2);
        background: rgba(0, 102, 255, 0.1);
        color: #0066ff;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .action-btn-icon:hover {
        background: rgba(0, 102, 255, 0.15);
    }
    
    .disconnect-device {
        background: rgba(220, 53, 69, 0.1);
        border: 1px solid rgba(220, 53, 69, 0.2);
        color: #dc3545;
    }
    
    .disconnect-device:hover {
        background: rgba(220, 53, 69, 0.15);
    }
    
    .reset-hwid-device.action-btn-icon {
        background: rgba(255, 193, 7, 0.1);
        border-color: rgba(255, 193, 7, 0.2);
        color: #ffc107;
    }
    
    .reset-hwid-device.action-btn-icon:hover {
        background: rgba(255, 193, 7, 0.15);
    }

    .device-primary-badge .badge, 
    .device-status .badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        height: 24px;
        padding: 0 10px;
        font-size: 12px;
        font-weight: 500;
        line-height: 1;
    }
    
    .device-primary-badge .badge {
        background-color: #0066ff;
        color: white;
        border-radius: 30px;
        box-shadow: 0 2px 5px rgba(0, 102, 255, 0.2);
    }
    
    .device-status .badge {
        border-radius: 20px;
    }
    
    .device-status .badge.bg-success {
        background-color: #28a745;
        box-shadow: 0 2px 4px rgba(40, 167, 69, 0.2);
    }
    
    .device-status .badge.bg-secondary {
        background-color: #6c757d;
        box-shadow: 0 2px 4px rgba(108, 117, 125, 0.2);
    }
    
    .badge i {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 4px;
    }

    /* Fix for device title line alignment */
    .device-title-line {
        display: flex !important;
        align-items: center !important;
        gap: 8px;
        height: 34px;
    }
    
    .device-name {
        font-size: 16px;
        font-weight: 600;
        margin: 0;
        padding: 0;
        display: flex !important;
        align-items: center !important;
        line-height: 1;
        height: 24px; /* Match badge height */
    }
    
    /* Badge alignment fixes */
    .device-primary-badge, 
    .device-status {
        display: flex !important;
        align-items: center !important;
    }
    
    .device-primary-badge .badge, 
    .device-status .badge {
        display: inline-flex !important;
        align-items: center !important;
        justify-content: center !important;
        height: 24px;
        padding: 0 10px;
        font-size: 12px;
        font-weight: 500;
        line-height: 1;
    }
    
    .badge i {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 4px;
    }

    /* New styles for password requirements */
    .password-requirement {
        font-size: 13px;
        color: #dc3545;
        margin-top: 5px;
        display: block;
    }
    
    /* Clean, completely rewritten password toggle button */
    .input-wrapper {
        position: relative;
    }
    
    .form-control {
        padding-right: 50px;
    }
    
    .password-toggle {
        position: absolute;
        top: 0;
        right: 0;
        width: 40px;
        height: 100%;
        background: none;
        border: none;
        color: #6c757d;
        text-align: center;
        cursor: pointer;
        outline: none;
    }
    
    .password-toggle:hover {
        color: #0066ff;
    }
</style>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Check for message in the URL parameters (for redirects with messages)
        const urlParams = new URLSearchParams(window.location.search);
        const messageParam = urlParams.get('message');
        const messageTypeParam = urlParams.get('message_type');
        
        if (messageParam) {
            showGlobalAlert(decodeURIComponent(messageParam), messageTypeParam || 'info');
        }
        
        // Check for server-rendered messages via data attributes
        const flashMessages = document.querySelectorAll('[data-flash-message]');
        flashMessages.forEach(el => {
            const message = el.getAttribute('data-flash-message');
            const messageType = el.getAttribute('data-flash-type') || 'info';
            if (message) {
                showGlobalAlert(message, messageType);
            }
        });
        
        // Tab system
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const tabId = this.dataset.tab;
                
                // Remove active class from all buttons and tabs
                tabBtns.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(tab => tab.classList.remove('active'));
                
                // Add active class to clicked button and corresponding tab
                this.classList.add('active');
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });
        
        // Copy button for connection code
        if(document.querySelector('.copy-btn')) {
            const copyBtn = document.querySelector('.copy-btn');
            copyBtn.addEventListener('click', function() {
                const code = this.dataset.clipboardText;
                navigator.clipboard.writeText(code).then(() => {
                    showGlobalAlert('Connection code copied to clipboard!', 'success');
                });
            });
        }
        
        // Password toggle functionality
        const passwordToggles = document.querySelectorAll('.password-toggle');
        passwordToggles.forEach(toggle => {
            toggle.addEventListener('click', function() {
                const targetId = this.dataset.target;
                const passwordInput = document.getElementById(targetId);
                const icon = this.querySelector('i');
                
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                } else {
                    passwordInput.type = 'password';
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                }
            });
        });
        
        // Password strength meter
        const newPasswordInput = document.getElementById('new_password');
        const strengthIndicator = document.querySelector('.strength-indicator');
        const strengthText = document.querySelector('.strength-text');
        
        if (newPasswordInput) {
            newPasswordInput.addEventListener('input', function() {
                const password = this.value;
                let strength = 0;
                let status = '';
                
                if (password.length > 0) {
                    // Length check
                    if (password.length >= 8) strength += 25;
                    
                    // Lowercase check
                    if (/[a-z]/.test(password)) strength += 25;
                    
                    // Uppercase check
                    if (/[A-Z]/.test(password)) strength += 25;
                    
                    // Numbers and special characters check
                    if (/[0-9!@#$%^&*(),.?":{}|<>]/.test(password)) strength += 25;
                    
                    // Set color based on strength
                    let color;
                    if (strength <= 25) {
                        status = 'Weak';
                        color = '#dc3545';
                    } else if (strength <= 50) {
                        status = 'Fair';
                        color = '#ffc107';
                    } else if (strength <= 75) {
                        status = 'Good';
                        color = '#0dcaf0';
                    } else {
                        status = 'Strong';
                        color = '#28a745';
                    }
                    
                    strengthIndicator.style.width = strength + '%';
                    strengthIndicator.style.background = color;
                    strengthText.textContent = status;
                } else {
                    strengthIndicator.style.width = '0%';
                    strengthText.textContent = 'Password strength';
                }
            });
        }
        
        // Regenerate code button
        if(document.getElementById('regenerateCodeBtn')) {
            const regenerateBtn = document.getElementById('regenerateCodeBtn');
            regenerateBtn.addEventListener('click', function() {
                showGlobalConfirm('Are you sure you want to regenerate your connection code? All connected devices will be disconnected.', function(confirmed) {
                    if(confirmed) {
                        fetch('/profile/regenerate-code', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            }
                        })
                        .then(response => response.json())
                        .then(data => {
                            if(data.success) {
                                document.querySelector('.connection-code').textContent = data.new_code;
                                document.querySelector('.copy-btn').dataset.clipboardText = data.new_code;
                                document.querySelector('.connection-status-badge').classList.remove('connected');
                                document.querySelector('.connection-status-badge').innerHTML = '<i class="fas fa-unlink"></i><span>Not Connected</span>';
                                showGlobalAlert('Connection code regenerated successfully', 'success');
                            } else {
                                showGlobalAlert(data.error || 'Error regenerating connection code', 'error');
                            }
                        })
                        .catch(error => {
                            showGlobalAlert('Error connecting to server', 'error');
                            console.error('Error:', error);
                        });
                    }
                });
            });
        }
        
        // Function to load devices
        function loadDevices() {
            const deviceList = document.getElementById('deviceList');
            const noDevices = document.getElementById('noDevices');
            
            // Check if elements exist (they might not for Standard users)
            if (!deviceList) {
                return; // Exit early if the device list container doesn't exist
            }
            
            fetch('/api/devices/list')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        if (data.devices && data.devices.length > 0) {
                            deviceList.innerHTML = '';
                            data.devices.forEach(device => {
                                const template = document.getElementById('deviceTemplate');
                                if (!template) {
                                    console.error('Device template not found');
                                    return;
                                }
                                
                                const clone = template.content.cloneNode(true);
                                
                                // Fill in device details
                                clone.querySelector('.device-name').textContent = device.device_name;
                                clone.querySelector('.device-id').textContent = `ID: ${device.device_id}`;
                                clone.querySelector('.device-os').textContent = device.device_os;
                                clone.querySelector('.device-connection').textContent = device.last_connection;
                                
                                // Set primary device badge
                                const primaryBadge = clone.querySelector('.device-primary-badge');
                                if (device.is_primary && primaryBadge) {
                                    primaryBadge.classList.remove('d-none');
                                }
                                
                                // Show connection status
                                const statusSpan = clone.querySelector('.device-status');
                                if (statusSpan) {
                                    if (device.is_active) {
                                        statusSpan.innerHTML = '<span class="badge bg-success"><i class="fas fa-circle mr-1"></i> Online</span>';
                                    } else {
                                        statusSpan.innerHTML = '<span class="badge bg-secondary"><i class="fas fa-circle mr-1"></i> Offline</span>';
                                    }
                                }
                                
                                // Set up disconnect button
                                const disconnectBtn = clone.querySelector('.disconnect-device');
                                // Only show disconnect button if device is online
                                if (device.is_active) {
                                    disconnectBtn.dataset.deviceId = device.device_id;
                                    disconnectBtn.addEventListener('click', function() {
                                        disconnectDevice(device.device_id);
                                    });
                                } else {
                                    // Hide disconnect button for offline devices
                                    disconnectBtn.style.display = 'none';
                                }
                                
                                // Set up reset HWID button
                                const resetBtn = clone.querySelector('.reset-hwid-device');
                                resetBtn.dataset.deviceId = device.device_id;
                                resetBtn.addEventListener('click', function() {
                                    resetHWID(device.device_id, device.device_name);
                                });
                                
                                // Fix vertical alignment after rendering
                                setTimeout(() => {
                                    const deviceItems = document.querySelectorAll('.device-item');
                                    deviceItems.forEach(item => {
                                        const titleLine = item.querySelector('.device-title-line');
                                        if (titleLine) {
                                            titleLine.style.display = 'flex';
                                            titleLine.style.alignItems = 'center';
                                        }
                                    });
                                }, 0);
                                
                                deviceList.appendChild(clone);
                            });
                            
                            deviceList.style.display = 'block';
                            if (noDevices) noDevices.classList.add('d-none');
                        } else {
                            deviceList.innerHTML = '';
                            if (noDevices) noDevices.classList.remove('d-none');
                        }
                        
                        // Show/hide reset button based on primary device status
                        const resetBtn = document.getElementById('resetPrimaryDeviceBtn');
                        if (resetBtn) {
                            resetBtn.style.display = data.has_primary_device ? 'flex' : 'none';
                        }
                    } else {
                        // Don't show error for standard users
                        if (data.error !== 'Premium subscription required') {
                            showGlobalAlert(data.error || 'Error loading devices', 'error');
                        }
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    // Only show error for premium users
                    if (document.querySelector('.profile-badge.premium') || document.querySelector('.profile-badge.admin')) {
                        showGlobalAlert('Error connecting to server', 'error');
                    }
                });
        }
        
        // Function to reset primary device
        function resetPrimaryDevice() {
            showGlobalConfirm('Are you sure you want to reset your device binding? This will allow you to connect from a different device.', function(confirmed) {
                if (confirmed) {
                    fetch('/api/devices/reset-primary', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            showGlobalAlert('Device binding has been reset. You can now connect from a different device.', 'success');
                            loadDevices(); // Reload the devices list
                        } else {
                            showGlobalAlert(data.error || 'Error resetting device binding', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showGlobalAlert('Error connecting to server', 'error');
                    });
                }
            });
        }
        
        // Function to disconnect a device
        function disconnectDevice(deviceId) {
            if (!deviceId) return;
            
            showGlobalConfirm('Are you sure you want to disconnect this device?', function(confirmed) {
                if (confirmed) {
                    fetch('/api/devices/disconnect', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ device_id: deviceId })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            showGlobalAlert('Device disconnected successfully', 'success');
                            loadDevices(); // Reload the devices list
                        } else {
                            showGlobalAlert(data.error || 'Error disconnecting device', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showGlobalAlert('Error connecting to server', 'error');
                    });
                }
            });
        }
        
        // Set up refresh button
        const refreshDevicesBtn = document.getElementById('refreshDevicesBtn');
        if (refreshDevicesBtn) {
            refreshDevicesBtn.addEventListener('click', loadDevices);
        }
        
        // Initial load of devices - only if the devices section exists
        if (document.getElementById('deviceList')) {
            loadDevices();
        }
        
        // Slot assignment buttons
        const slotAssignBtns = document.querySelectorAll('.slot-assign-btn');
        slotAssignBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const inputField = this.parentElement.querySelector('.slot-input');
                const username = inputField.value.trim();
                
                if(!username) {
                    showGlobalAlert('Please enter a username', 'error');
                    return;
                }
                
                alignUserToSlot(username);
            });
        });
        
        // Slot input fields - add enter key support
        const slotInputs = document.querySelectorAll('.slot-input');
        slotInputs.forEach(input => {
            input.addEventListener('keypress', function(e) {
                if(e.key === 'Enter') {
                    e.preventDefault();
                    const username = this.value.trim();
                    if(username) {
                        alignUserToSlot(username);
                    } else {
                        showGlobalAlert('Please enter a username', 'error');
                    }
                }
            });
        });
        
        // Remove user buttons
        const removeUserBtns = document.querySelectorAll('.remove-user-btn');
        removeUserBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const username = this.dataset.username;
                showGlobalConfirm(`Are you sure you want to remove ${username} from your slot?\n\nNOTE: After removing a user from a slot, you must wait 7 days before removing another user from that same slot. You can still assign users to your other available slots immediately.`, function(confirmed) {
                    if(confirmed) {
                        removeUserFromSlot(username);
                    }
                });
            });
        });
        
        // Self-disalign button
        const disalignSelfBtns = document.querySelectorAll('.disalign-self-btn');
        disalignSelfBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const username = this.dataset.username;
                showGlobalConfirm('Are you sure you want to remove yourself from this alignment? You will lose Premium status.', function(confirmed) {
                    if(confirmed) {
                        disalignSelf(username);
                    }
                });
            });
        });
        
        // Function to align a user to a slot
        function alignUserToSlot(username) {
            fetch('/api/slots/align-user', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username: username })
            })
            .then(response => response.json())
            .then(data => {
                if(data.success) {
                    showGlobalAlert(`User ${username} has been successfully assigned to your slot`, 'success');
                    // Reload the page to show changes
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                } else {
                    showGlobalAlert(data.error || 'Error aligning user', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showGlobalAlert('Error connecting to server', 'error');
            });
        }
        
        // Function to remove a user from a slot
        function removeUserFromSlot(username) {
            fetch('/api/slots/remove-user', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username: username })
            })
            .then(response => response.json())
            .then(data => {
                if(data.success) {
                    showGlobalAlert(`User ${username} removed from your slot`, 'success');
                    // Reload the page to show changes
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                } else {
                    showGlobalAlert(data.error || 'Error removing user', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showGlobalAlert('Error connecting to server', 'error');
            });
        }
        
        // Function for a user to disalign themselves
        function disalignSelf(username) {
            fetch('/api/slots/disalign-self', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username: username })
            })
            .then(response => response.json())
            .then(data => {
                if(data.success) {
                    showGlobalAlert('You have been disaligned from the slot', 'success');
                    // Reload the page to show changes
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                } else {
                    showGlobalAlert(data.error || 'Error disaligning', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showGlobalAlert('Error connecting to server', 'error');
            });
        }
        
        // Alert system
        function showGlobalAlert(message, type = 'info') {
            // Create an alert
            const alertContainer = document.createElement('div');
            alertContainer.className = `alert-container ${type}`;
            
            const alertContent = document.createElement('div');
            alertContent.className = 'alert-content';
            
            const icon = document.createElement('i');
            if (type === 'success') {
                icon.className = 'fas fa-check-circle';
            } else if (type === 'error' || type === 'danger') {
                icon.className = 'fas fa-exclamation-circle';
            } else {
                icon.className = 'fas fa-info-circle';
            }
            
            const text = document.createElement('span');
            text.textContent = message;
            
            const closeBtn = document.createElement('button');
            closeBtn.className = 'alert-close';
            closeBtn.innerHTML = '<i class="fas fa-times"></i>';
            closeBtn.addEventListener('click', () => {
                alertContainer.classList.remove('show');
                setTimeout(() => {
                    if (document.body.contains(alertContainer)) {
                        document.body.removeChild(alertContainer);
                    }
                }, 300);
            });
            
            alertContent.appendChild(icon);
            alertContent.appendChild(text);
            alertContainer.appendChild(alertContent);
            alertContainer.appendChild(closeBtn);
            
            // Remove existing alerts
            const existingAlerts = document.querySelectorAll('.alert-container');
            existingAlerts.forEach(alert => {
                if (document.body.contains(alert)) {
                    document.body.removeChild(alert);
                }
            });
            
            document.body.appendChild(alertContainer);
            
            // Show alert with animation
            setTimeout(() => {
                alertContainer.classList.add('show');
            }, 10);
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                if (document.body.contains(alertContainer)) {
                    alertContainer.classList.remove('show');
                    setTimeout(() => {
                        if (document.body.contains(alertContainer)) {
                            document.body.removeChild(alertContainer);
                        }
                    }, 300);
                }
            }, 5000);
        }
        
        // Confirm dialog function
        function showGlobalConfirm(message, callback) {
            // Create background overlay
            const overlay = document.createElement('div');
            overlay.className = 'confirm-overlay';
            overlay.style.position = 'fixed';
            overlay.style.top = '0';
            overlay.style.left = '0';
            overlay.style.width = '100%';
            overlay.style.height = '100%';
            overlay.style.background = 'rgba(0, 0, 0, 0.5)';
            overlay.style.zIndex = '9998';
            overlay.style.display = 'flex';
            overlay.style.alignItems = 'center';
            overlay.style.justifyContent = 'center';
            
            // Create confirm dialog
            const confirmBox = document.createElement('div');
            confirmBox.className = 'confirm-box';
            confirmBox.style.background = 'rgba(30, 30, 40, 0.95)';
            confirmBox.style.borderRadius = '10px';
            confirmBox.style.padding = '20px';
            confirmBox.style.width = '90%';
            confirmBox.style.maxWidth = '400px';
            confirmBox.style.boxShadow = '0 5px 15px rgba(0, 0, 0, 0.3)';
            confirmBox.style.zIndex = '9999';
            confirmBox.style.animation = 'fadeIn 0.3s';
            
            // Create message
            const messageEl = document.createElement('div');
            messageEl.className = 'confirm-message';
            messageEl.style.marginBottom = '20px';
            messageEl.style.color = 'white';
            messageEl.style.fontSize = '16px';
            messageEl.style.lineHeight = '1.5';
            messageEl.textContent = message;
            
            // Create buttons container
            const buttonsContainer = document.createElement('div');
            buttonsContainer.className = 'confirm-buttons';
            buttonsContainer.style.display = 'flex';
            buttonsContainer.style.justifyContent = 'flex-end';
            buttonsContainer.style.gap = '10px';
            
            // Create cancel button
            const cancelBtn = document.createElement('button');
            cancelBtn.className = 'confirm-cancel';
            cancelBtn.style.padding = '8px 15px';
            cancelBtn.style.background = 'rgba(108, 117, 125, 0.2)';
            cancelBtn.style.color = 'white';
            cancelBtn.style.border = 'none';
            cancelBtn.style.borderRadius = '5px';
            cancelBtn.style.cursor = 'pointer';
            cancelBtn.textContent = 'Cancel';
            cancelBtn.addEventListener('click', () => {
                document.body.removeChild(overlay);
                if (typeof callback === 'function') {
                    callback(false);
                }
            });
            
            // Create confirm button
            const confirmBtn = document.createElement('button');
            confirmBtn.className = 'confirm-ok';
            confirmBtn.style.padding = '8px 15px';
            confirmBtn.style.background = 'rgba(220, 53, 69, 0.8)';
            confirmBtn.style.color = 'white';
            confirmBtn.style.border = 'none';
            confirmBtn.style.borderRadius = '5px';
            confirmBtn.style.cursor = 'pointer';
            confirmBtn.textContent = 'Confirm';
            confirmBtn.addEventListener('click', () => {
                document.body.removeChild(overlay);
                if (typeof callback === 'function') {
                    callback(true);
                }
            });
            
            // Add elements to confirm box
            buttonsContainer.appendChild(cancelBtn);
            buttonsContainer.appendChild(confirmBtn);
            confirmBox.appendChild(messageEl);
            confirmBox.appendChild(buttonsContainer);
            overlay.appendChild(confirmBox);
            
            // Add to document
            document.body.appendChild(overlay);
            
            // Focus confirm button
            confirmBtn.focus();
        }

        // Function to reset HWID (device binding)
        function resetHWID(deviceId, deviceName) {
            showGlobalConfirm(`Are you sure you want to reset the HWID for device "${deviceName}"? This will allow you to connect from a different device.\n\nNote: HWID can only be reset once per week.`, function(confirmed) {
                if (confirmed) {
                    fetch('/api/devices/reset-primary', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            showGlobalAlert('Device binding (HWID) has been reset. You can now connect from a different device.', 'success');
                            loadDevices(); // Reload the devices list
                        } else {
                            // Show specific error message
                            if (data.error && data.error.includes('HWID can only be reset once per week')) {
                                showGlobalAlert(data.error, 'error');
                            } else {
                                showGlobalAlert(data.error || 'Error resetting device binding', 'error');
                            }
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showGlobalAlert('Error connecting to server', 'error');
                    });
                }
            });
        }
    });
</script>
{% endblock %} 